<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>job-copilot — Profile</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="color-scheme" content="light" />
  <link rel="stylesheet" href="style.css" />
  <style>
    /* Page bits */
    .jd{white-space:pre-wrap;font-size:14px;line-height:1.5;max-height:320px;overflow:auto;padding:10px;border:1px solid var(--border);border-radius:8px;background:#fff;scrollbar-gutter:stable}
    .modal-content{width:min(980px,92vw);max-height:86vh;overflow:auto;background:#fff;border-radius:12px;box-shadow:0 8px 30px rgba(0,0,0,.2)}
    .modal-header{display:flex;justify-content:space-between;align-items:center;padding:12px 14px;border-bottom:1px solid var(--border);position:sticky;top:0;background:#fff}
    .modal-body{padding:14px}
    .docx-wrap{background:#6b7280;padding:14px;display:flex;justify-content:center;border-radius:8px}
    .docx .page{background:#fff;box-shadow:0 6px 18px rgba(0,0,0,.2);margin:12px 0}
    .muted.small{font-size:12px;color:#6b7280}
    /* Overlay assistive fallback for browsers without inert */
    main[inert]{pointer-events:none;user-select:none}
    @media (prefers-reduced-motion: reduce){ .spinner{animation:none!important} }
  </style>
</head>
<body>
  <a href="#main" class="skip-link">Skip to main content</a>

  <header class="site-header" role="banner">
    <div class="bar container">
      <div class="brand"><span class="dot" aria-hidden="true"></span> job-copilot</div>
      <nav class="nav" aria-label="Primary">
        <a href="./">Home</a>
        <a href="power-edit.html">Power Edit</a>
        <a class="btn" href="login.html">Sign in</a>
      </nav>
    </div>
  </header>

  <main id="main" class="container section" aria-labelledby="page-title">
    <h1 id="page-title" style="margin:0 0 6px 0">Your profile</h1>
    <p class="muted">Parsed from your latest resume + saved targets. This page updates after each run.</p>

    <div class="row mt-2" role="group" aria-label="Quick links">
      <a class="btn" href="feedback.html">Give Feedback</a>
      <a class="btn primary" href="power-edit.html" target="_blank" rel="noopener">Open Power Edit</a>
    </div>

    <p id="signinOnly" class="mt-3"><a href="login.html">Sign in</a> to view your profile.</p>

    <!-- Profile -->
    <section id="profile" class="card hidden" aria-live="polite" aria-labelledby="who-heading">
      <div class="row" style="justify-content:space-between;align-items:center;">
        <h2 id="who-heading" class="sr-only">Signed-in user</h2>
        <span id="who" class="pill"></span>
        <a class="pill" href="./">← Back</a>
      </div>

      <dl style="display:grid;grid-template-columns:180px 1fr;gap:6px 14px;margin:12px 0 0 0">
        <dt>Full name</dt><dd id="full_name">—</dd>
        <dt>Email</dt><dd id="email">—</dd>
        <dt>Phone</dt><dd id="phone">—</dd>
        <dt>Skills</dt><dd id="skills">—</dd>
        <dt>Desired titles</dt><dd id="titles">—</dd>
        <dt>Locations</dt><dd id="locs">—</dd>
        <dt>Search policy</dt><dd id="policy" class="muted">—</dd>
        <dt>Updated</dt><dd id="updated">—</dd>
      </dl>
    </section>

    <!-- Controls -->
    <section id="onboard" class="card hidden mt-4" aria-labelledby="upd-title">
      <div class="row" style="justify-content:space-between">
        <strong id="upd-title">Update &amp; run</strong>
        <button id="logout" class="btn" type="button">Sign out</button>
      </div>

      <ol style="margin-top:8px">
        <li style="margin:10px 0">
          <strong>Upload your resume (.docx)</strong><br/>
          <label class="sr-only" for="resume">Resume file</label>
          <input type="file" id="resume" accept=".docx" class="ctl" />
          <button id="uploadResume" class="btn" type="button">Upload</button>
          <span id="upMsg" class="status" aria-live="polite"></span>
        </li>

        <li style="margin:10px 0">
          <strong>Targets (saved to your profile)</strong><br/>
          <label for="desiredTitles">Desired titles <small>(comma-separated)</small></label>
          <input id="desiredTitles" class="ctl" type="text" placeholder="Editor, Editorial Assistant" style="min-width:280px" />
          <label for="desiredLocs">Locations <small>(comma-separated)</small></label>
          <input id="desiredLocs" class="ctl" type="text" placeholder="Remote, Virginia, East Coast" style="min-width:280px" />
          <div class="row" style="margin-top:6px">
            <label for="recencyDays">Recency days</label>
            <input id="recencyDays" class="ctl" type="number" min="0" value="0" style="max-width:120px" />
            <label><input id="remoteOnly" type="checkbox" /> Remote-only</label>
            <label><input id="requirePosted" type="checkbox" /> Require posted date</label>
          </div>
        </li>

        <li style="margin:10px 0">
          <strong>Run crawl &amp; rank</strong><br/>
          <button id="runTailor" class="btn primary" type="button" aria-controls="runOverlay" aria-expanded="false">Run my shortlist</button>
          <span id="runMsg" class="status" aria-live="polite"></span>
        </li>

        <li style="margin:10px 0">
          <strong>Draft covers &amp; tailored resumes</strong><br/>
          <label for="topN">Top roles to draft</label>
          <input id="topN" class="ctl" type="number" min="1" max="20" value="5" style="max-width:120px" />
          <button id="runDrafts" class="btn" type="button">Draft my materials</button>
          <span id="draftMsg" class="status" aria-live="polite"></span>
        </li>
      </ol>
    </section>

    <!-- AFTER (DOCX styles) -->
    <section id="afterDocxCard" class="card hidden mt-4" aria-labelledby="after-docx-title">
      <div class="row" style="justify-content:space-between;align-items:center">
        <div>
          <h2 id="after-docx-title" style="margin:0 0 6px 0">After (DOCX styles)</h2>
          <p class="muted small" style="margin:0">Exact clone of your formatted resume with AI-woven text applied.</p>
        </div>
        <div class="row" style="gap:8px">
          <label for="afterChange" class="sr-only">Change set</label>
          <select id="afterChange" class="ctl" style="min-width:260px"></select>
          <button id="afterRender" class="btn" type="button">Render</button>
        </div>
      </div>
      <div id="afterDocxWrap" class="docx-wrap" style="margin-top:10px">
        <div id="afterDocx" class="docx" role="region" aria-label="After resume preview"></div>
      </div>
      <div id="afterDocxMsg" class="status" aria-live="polite"></div>
    </section>

    <!-- Power Edit card (opens new tab) -->
    <section class="card mt-4" id="powerEditCard" aria-labelledby="pe-title">
      <div class="row" style="justify-content:space-between">
        <div>
          <h2 id="pe-title" style="margin:0 0 6px 0;">Power Edit (resume)</h2>
          <p class="muted" style="margin:0">Upload your .docx and paste a job description to get live score, gaps, coverage, and suggested inserts. Opens in a new tab.</p>
        </div>
        <div>
          <a class="btn primary" href="power-edit.html" target="_blank" rel="noopener" aria-label="Open Power Edit in a new tab">Open Power Edit</a>
        </div>
      </div>
    </section>

    <!-- Applications tracker -->
    <details id="tracker" class="card hidden mt-4">
      <summary>
        <div class="row" style="align-items:center;gap:10px">
          <h2 style="margin:0">Applications tracker</h2>
          <span id="trackerCount" class="pill" aria-live="polite">0</span>
        </div>
        <span class="muted small">click to expand</span>
      </summary>
      <div class="card-body">
        <div class="row" style="justify-content:flex-end;margin-bottom:8px">
          <button id="refreshTracker" class="btn" type="button">Refresh</button>
        </div>
        <div id="trackerList"></div>
      </div>
    </details>

    <!-- Shortlist -->
    <details id="shortlist" class="card hidden mt-4">
      <summary>
        <div class="row" style="align-items:center;gap:10px">
          <h2 style="margin:0">Your shortlist</h2>
          <span id="shortlistCount" class="pill" aria-live="polite">0</span>
        </div>
        <span class="muted small">click to expand</span>
      </summary>
      <div class="card-body">
        <div class="row" style="margin:6px 0">
          <button id="refresh" class="btn" type="button">Refresh</button>
        </div>
        <table id="jobs" class="hidden" aria-describedby="noData">
          <thead><tr><th>Score</th><th>Title</th><th>Company</th><th>Location</th><th>Posted</th></tr></thead>
          <tbody></tbody>
        </table>
        <div id="noData" class="muted">No shortlist yet.</div>
      </div>
    </details>

    <!-- Materials -->
    <section id="materials" class="card hidden mt-4" aria-labelledby="materials-title">
      <h2 id="materials-title">Your generated materials</h2>
      <p class="muted">Created by “Draft covers & tailored resumes”.</p>
      <h3 style="margin-top:8px">JD-aware previews</h3>
      <div id="cards" class="cards"></div>
    </section>
  </main>

  <!-- Run overlay (dialog) -->
  <div id="runOverlay" class="overlay" role="dialog" aria-modal="true" aria-labelledby="runTitle" aria-describedby="runDesc">
    <div class="overlay-card">
      <div class="row" style="margin-bottom:10px">
        <div class="spinner" aria-hidden="true" style="width:34px;height:34px;border:3px solid #e5e7eb;border-top-color:#4f46e5;border-radius:50%;animation:spin 1s linear infinite;margin-right:8px"></div>
        <div>
          <div id="runTitle" style="font-weight:700">Building your shortlist…</div>
          <div id="runDesc" class="muted">This usually takes 3–8 minutes. You can keep working — we’ll keep checking in the background.</div>
        </div>
      </div>
      <div class="progress" style="margin:8px 0 12px">
        <div class="bar" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuetext="Running…"></div>
      </div>
      <div class="row" style="justify-content:flex-end">
        <button id="overlayRefresh" class="btn" type="button">Refresh now</button>
        <button id="overlayHide" class="btn" type="button" aria-label="Hide progress overlay">Hide</button>
      </div>
      <div id="eta" class="muted" style="margin-top:8px" role="status" aria-live="polite"></div>
    </div>
  </div>

  <!-- Floating “Show progress” button -->
  <button id="progressFab" class="btn fab hidden" type="button" title="Show progress">Show progress</button>

  <!-- Change Log Modal -->
  <div id="change-modal" class="modal" role="dialog" aria-modal="true" aria-labelledby="changeTitle">
    <div class="modal-content">
      <div class="modal-header">
        <strong id="changeTitle">Resume change</strong>
        <button class="close btn" type="button" aria-label="Close">Close</button>
      </div>
      <div class="modal-body">Loading…</div>
    </div>
  </div>

  <!-- ===== Scripts (all deferred; order matters) ===== -->

  <!-- Supabase UMD -->
  <script defer src="https://unpkg.com/@supabase/supabase-js@2/dist/umd/supabase.js"></script>

  <!-- Supabase project globals + SINGLE shared client for the whole page -->
  <script defer>
    window.SUPABASE_URL  = "https://imozfqawxpsasjdmgdkh.supabase.co";
    window.SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imltb3pmcWF3eHBzYXNqZG1nZGtoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTg1Njk3NTUsImV4cCI6MjA3NDE0NTc1NX0.fkGObZvEy-oUfLrPcwgTSJbc-n6O5aE31SGIBeXImtc";
    window.__sbclient = window.__sbclient || (window.supabase
      ? window.supabase.createClient(window.SUPABASE_URL, window.SUPABASE_ANON_KEY)
      : null);
  </script>

  <!-- docx-preview for styled rendering -->
  <script defer src="https://cdn.jsdelivr.net/npm/docx-preview@0.3.4/dist/docx-preview.min.js"></script>

  <!-- Page logic (use the shared client if available) -->
  <script defer>
    (function(){
      // let profile.js reuse the shared client if present
      window.__useSharedSupabase = true;
    })();
  </script>
  <script defer src="/job-copilot/profile.js?v=2025-10-23-after-docx"></script>

  <!-- Utilities -->
  <script defer src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
  <script defer src="js/feedback.js?v=2025-10-12"></script>

  <!-- DomAgent (must load before voice UI) -->
  <script defer src="js/dom-agent.js"></script>

  <!-- Voice assistant (uses window.DomAgent + shared Supabase client) -->
  <script defer src="js/voice-assistant.js"></script>
</body>
</html>
